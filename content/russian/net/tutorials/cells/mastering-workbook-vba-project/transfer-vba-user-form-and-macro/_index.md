---
title: Передача пользовательских форм и макросов VBA между рабочими книгами Excel
linktitle: Передача пользовательских форм и макросов VBA между рабочими книгами Excel
second_title: API обработки Excel Aspose.Cells .NET
description: Откройте для себя мощь автоматизации Excel с этим всеобъемлющим руководством по переносу пользовательских форм VBA и макросов между рабочими книгами с помощью Aspose.Cells для .NET. Идеально подходит как для новичков, так и для опытных разработчиков.
type: docs
weight: 11
url: /ru/net/tutorials/cells/mastering-workbook-vba-project/transfer-vba-user-form-and-macro/
---
## Введение

Добро пожаловать в ваше полное руководство по улучшению вашего опыта Excel с помощью макросов VBA и пользовательских форм! В этом руководстве мы рассмотрим, как перенести конструктор UserForm макросов VBA из одной рабочей книги в другую с помощью мощной библиотеки Aspose.Cells для .NET. Независимо от того, являетесь ли вы опытным разработчиком или только начинаете, это пошаговое руководство снабдит вас знаниями для программной обработки файлов Excel. Готовы погрузиться? Давайте начнем!

## Предпосылки
Прежде чем приступить к кодированию, давайте убедимся, что у вас есть все необходимое:

1. Среда разработки C#: рабочая среда для разработки на C#, настоятельно рекомендуется Visual Studio.
2.  Библиотека Aspose.Cells для .NET: Обязательно интегрируйте библиотеку Aspose.Cells в свой проект. Вы можете легко[скачать здесь](https://releases.aspose.com/cells/net/).
3. Базовые знания макросов VBA и Excel: знакомство с VBA и принципами работы макросов Excel улучшит ваше понимание этого руководства.
4. Файл Excel с формой пользователя: создайте или получите книгу Excel, содержащую форму пользователя (предпочтительно с включенными макросами, например`.xlsm` файлы).

## Импорт необходимых пакетов
Чтобы использовать функциональные возможности Aspose.Cells, включите следующие пространства имен в начало файла C#:

```csharp
using System;
using Aspose.Cells;
using Aspose.Cells.Vba;
```

Эти пространства имен предоставят вам доступ к мощным инструментам, встроенным в библиотеку Aspose.Cells.

## Шаг 1: Определите исходные и выходные каталоги
Сначала определите местоположение ваших файлов:

```csharp
// Определите исходный и выходной каталоги
string sourceDir = @"Your\Source\Directory\";
string outputDir = @"Your\Output\Directory\";
```

Замените пути-заполнители фактическими каталогами, в которых хранятся ваши файлы.

## Шаг 2: Создайте пустую целевую рабочую книгу
Далее создайте новую книгу, в которую вы скопируете пользовательскую форму и макросы:

```csharp
// Создать пустую целевую книгу
Workbook target = new Workbook();
```

Это инициализирует пустую рабочую книгу, которая будет служить холстом для предстоящей передачи данных.

## Шаг 3: Загрузите шаблон рабочей книги
Загрузите рабочую книгу, содержащую вашу пользовательскую форму и макросы:

```csharp
// Загрузите файл Excel, содержащий форму пользователя VBA-Macro Designer.
Workbook templateFile = new Workbook(sourceDir + "sampleDesignerForm.xlsm");
```

Регулировать`"sampleDesignerForm.xlsm"` на имя вашего фактического файла.

## Шаг 4: Копирование рабочих листов в целевую рабочую книгу
Теперь давайте скопируем рабочие листы из шаблона в целевую рабочую книгу:

```csharp
// Скопируйте все шаблоны рабочих листов в целевую рабочую книгу.
foreach (Worksheet ws in templateFile.Worksheets)
{
    if (ws.Type == SheetType.Worksheet)
    {
        Worksheet s = target.Worksheets.Add(ws.Name);
        s.Copy(ws);
        // Добавьте сообщение в ячейку A2 целевого рабочего листа.
        s.Cells["A2"].PutValue("VBA Macro and User Form copied from template to target.");
    }
}
```

Этот код проходит по каждому рабочему листу в шаблоне и копирует его в целевую рабочую книгу, гарантируя бесперебойную передачу всех ваших данных.

## Шаг 5: Скопируйте макросы VBA из шаблона
Далее мы скопируем макросы VBA, включая модули UserForm Designer, в новую книгу:

```csharp
// Копировать пользовательскую форму VBA-Macro Designer из шаблона в целевой объект
foreach (VbaModule vbaItem in templateFile.VbaProject.Modules)
{
    if (vbaItem.Name == "ThisWorkbook")
    {
        // Скопировать код модуля ThisWorkbook
        target.VbaProject.Modules["ThisWorkbook"].Codes = vbaItem.Codes;
    }
    else
    {
        // Копировать код и данные других модулей
        int vbaMod = target.VbaProject.Modules.Add(vbaItem.Type, vbaItem.Name);
        target.VbaProject.Modules[vbaMod].Codes = vbaItem.Codes;

        if (vbaItem.Type == VbaModuleType.Designer)
        {
            // Получить хранилище конструктора пользовательских форм
            byte[] designerStorage = templateFile.VbaProject.Modules.GetDesignerStorage(vbaItem.Name);
            // Добавьте хранилище дизайнера в целевой проект Vba
            target.VbaProject.Modules.AddDesignerStorage(vbaItem.Name, designerStorage);
        }
    }
}
```

Этот код гарантирует, что копируется не только код, но и дизайн пользовательской формы, что сохраняет функциональность ваших макросов.

## Шаг 6: Сохраните целевую рабочую книгу
После завершения процесса копирования сохраните новую книгу:

```csharp
// Сохраните целевую рабочую книгу
target.Save(outputDir + "outputDesignerForm.xlsm", SaveFormat.Xlsm);
```

Измените имя выходного файла по мере необходимости. Этот шаг создает вашу персонализированную рабочую книгу, заполненную макросами и пользовательскими формами.

## Шаг 7: Подтвердите успех
Наконец, выведите на консоль сообщение об успешном завершении:

```csharp
Console.WriteLine("CopyVBAMacroUserFormDesignerStorageToWorkbook executed successfully.\r\n");
```

Эта простая строка заверит вас, что ваш процесс прошел гладко, — важное подтверждение вашей упорной работы!

## Заключение
Поздравляем! Вы успешно научились копировать конструктор пользовательских форм макросов VBA из одной рабочей книги в другую с помощью Aspose.Cells для .NET. Хотя поначалу это может показаться сложным, практика сделает вас опытным в манипуляциях с рабочими книгами. Помните, что кодирование — это эксперимент, поэтому не стесняйтесь исследовать различные функции в ваших файлах Excel. Если у вас есть какие-либо вопросы или вам нужна помощь, форумы и документация Aspose — отличные ресурсы для поддержки.

## Часто задаваемые вопросы

### Какие версии Excel поддерживает Aspose.Cells?
Aspose.Cells поддерживает различные форматы Excel, включая XLSX, XLSM, CSV и другие.

### Могу ли я использовать Aspose.Cells бесплатно?
 Да! Вы можете начать с бесплатной пробной версии, чтобы оценить библиотеку:[Бесплатная пробная версия](https://releases.aspose.com/).

### Нужна ли мне Visual Studio для запуска этого кода?
Хотя Visual Studio рекомендуется использовать из-за его удобных для пользователя функций, подойдет любая среда разработки C#, поддерживающая разработку .NET.

### Где я могу найти больше примеров и документации?
 Вы можете исследовать[Документация Aspose.Cells](https://reference.aspose.com/cells/net/) для получения дополнительных примеров и подробных объяснений.

### Как решить проблемы при использовании Aspose.Cells?
 Вам следует посетить[Форум поддержки Aspose](https://forum.aspose.com/c/cells/9) за помощь от сообщества и службы поддержки Aspose.